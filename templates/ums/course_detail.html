{% extends 'base.html' %}
{% load static %}

{% block title %}{{ course.title }} - Eco-Nexus University Management System{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- Breadcrumb -->
    <nav class="mb-6 text-sm text-gray-600">
        <a href="{% url 'ums:course_list' %}" class="text-blue-600 hover:underline">â† All Courses</a>
    </nav>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Main Content (2/3) -->
        <div class="lg:col-span-2">
            <!-- Course Header -->
            <div class="bg-gradient-to-r from-blue-50 to-green-50 rounded-lg p-8 mb-8 border border-blue-300">
                <h1 class="text-4xl font-bold text-gray-800 mb-2">{{ course.title }}</h1>
                
                <div class="flex flex-wrap gap-6 text-sm mb-6 mt-4">
                    <div class="flex items-center gap-2 text-gray-700">
                        <span>ğŸ‘¨â€ğŸ“</span>
                        <span>{{ course.instructor_name }}</span>
                    </div>
                    <div class="flex items-center gap-2 text-gray-700">
                        <span>ğŸ“š</span>
                        <span>{{ course.department.name }}</span>
                    </div>
                    <div class="flex items-center gap-2 text-gray-700">
                        <span>ğŸ“Š</span>
                        <span>{{ course.credits }} Credits</span>
                    </div>
                    <div class="flex items-center gap-2 text-gray-700">
                        <span>ğŸ“…</span>
                        <span>{{ course.semester.name }}</span>
                    </div>
                </div>

                <!-- Rating -->
                <div class="flex items-center gap-3">
                    <div class="flex gap-1">
                        {% for i in "12345" %}
                        {% if i|add:"0" <= course.rating %}
                        <span class="text-2xl text-yellow-500">â˜…</span>
                        {% else %}
                        <span class="text-2xl text-gray-300">â˜…</span>
                        {% endif %}
                        {% endfor %}
                    </div>
                    <span class="text-gray-700"><strong>{{ course.rating }}/5</strong> ({{ course.reviews_count }} reviews)</span>
                </div>
            </div>

            <!-- Course Overview -->
            <div class="bg-white rounded-lg shadow-md p-8 mb-8 border border-gray-200">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">ğŸ“– Course Overview</h2>
                <p class="text-gray-700 mb-4">{{ course.description }}</p>
                
                {% if course.detailed_description %}
                <div class="prose prose-sm max-w-none text-gray-700">
                    {{ course.detailed_description|linebreaks }}
                </div>
                {% endif %}
            </div>

            <!-- Course Details Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <!-- Learning Outcomes -->
                <div class="bg-white rounded-lg shadow-md p-6 border border-gray-200">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ¯ Learning Outcomes</h3>
                    <ul class="space-y-2 text-sm text-gray-700">
                        <li class="flex gap-2">
                            <span>âœ“</span>
                            <span>Understand key environmental concepts and principles</span>
                        </li>
                        <li class="flex gap-2">
                            <span>âœ“</span>
                            <span>Apply sustainability practices in real-world scenarios</span>
                        </li>
                        <li class="flex gap-2">
                            <span>âœ“</span>
                            <span>Analyze environmental challenges and propose solutions</span>
                        </li>
                        <li class="flex gap-2">
                            <span>âœ“</span>
                            <span>Develop professional skills in your field</span>
                        </li>
                    </ul>
                </div>

                <!-- Course Requirements -->
                <div class="bg-white rounded-lg shadow-md p-6 border border-gray-200">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ“‹ Requirements</h3>
                    <ul class="space-y-2 text-sm text-gray-700">
                        <li><strong>Prerequisites:</strong> {{ course.prerequisites|default:"None" }}</li>
                        <li><strong>Level:</strong> {{ course.difficulty_level|default:"Intermediate" }}</li>
                        <li><strong>Hours/Week:</strong> 3-4 hours</li>
                        <li><strong>Workload:</strong> Moderate</li>
                    </ul>
                </div>
            </div>

            <!-- Course Curriculum -->
            <div class="bg-white rounded-lg shadow-md p-8 mb-8 border border-gray-200">
                <h3 class="text-2xl font-bold text-gray-800 mb-6">ğŸ“š Course Curriculum</h3>
                
                <div class="space-y-4">
                    {% for i in "123456" %}
                    <div class="border-l-4 border-blue-600 pl-4">
                        <h4 class="font-bold text-gray-800">Module {{ i }}: Sample Module Title</h4>
                        <p class="text-sm text-gray-600 mt-1">Learn the fundamentals and advanced concepts of this topic. Includes lectures, readings, and practical assignments.</p>
                        <div class="text-xs text-gray-500 mt-2">
                            <span>ğŸ“… Week {{ i }}</span> â€¢ 
                            <span>ğŸ“¹ 4 videos</span> â€¢ 
                            <span>ğŸ“„ 3 readings</span> â€¢ 
                            <span>âœï¸ 1 assignment</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Grading & Assessments -->
            <div class="bg-white rounded-lg shadow-md p-8 mb-8 border border-gray-200">
                <h3 class="text-2xl font-bold text-gray-800 mb-6">ğŸ“Š Grading & Assessment</h3>
                
                <div class="space-y-3">
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <span class="text-gray-700">Participation</span>
                        <span class="font-bold text-gray-800">10%</span>
                        <div class="w-24 bg-gray-300 rounded-full h-2">
                            <div class="bg-blue-600 h-2 rounded-full" style="width: 10%"></div>
                        </div>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <span class="text-gray-700">Assignments</span>
                        <span class="font-bold text-gray-800">30%</span>
                        <div class="w-24 bg-gray-300 rounded-full h-2">
                            <div class="bg-blue-600 h-2 rounded-full" style="width: 30%"></div>
                        </div>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <span class="text-gray-700">Midterm Exam</span>
                        <span class="font-bold text-gray-800">25%</span>
                        <div class="w-24 bg-gray-300 rounded-full h-2">
                            <div class="bg-blue-600 h-2 rounded-full" style="width: 25%"></div>
                        </div>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <span class="text-gray-700">Final Project</span>
                        <span class="font-bold text-gray-800">35%</span>
                        <div class="w-24 bg-gray-300 rounded-full h-2">
                            <div class="bg-blue-600 h-2 rounded-full" style="width: 35%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Resources & Materials -->
            <div class="bg-white rounded-lg shadow-md p-8 border border-gray-200">
                <h3 class="text-2xl font-bold text-gray-800 mb-6">ğŸ“š Resources & Materials</h3>
                
                <div class="space-y-3">
                    <div class="flex items-center gap-3 p-4 bg-blue-50 rounded-lg border border-blue-200">
                        <span class="text-2xl">ğŸ“–</span>
                        <div>
                            <p class="font-semibold text-gray-800">Textbook</p>
                            <p class="text-sm text-gray-600">Required textbook available at campus bookstore</p>
                        </div>
                    </div>

                    <div class="flex items-center gap-3 p-4 bg-green-50 rounded-lg border border-green-200">
                        <span class="text-2xl">ğŸ’»</span>
                        <div>
                            <p class="font-semibold text-gray-800">Online Materials</p>
                            <p class="text-sm text-gray-600">Lecture videos, lecture notes, and case studies available online</p>
                        </div>
                    </div>

                    <div class="flex items-center gap-3 p-4 bg-orange-50 rounded-lg border border-orange-200">
                        <span class="text-2xl">ğŸ”¬</span>
                        <div>
                            <p class="font-semibold text-gray-800">Lab Resources</p>
                            <p class="text-sm text-gray-600">Access to laboratory equipment and facilities</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar (1/3) -->
        <div class="lg:col-span-1">
            <!-- Enrollment Card -->
            <div class="bg-white rounded-lg shadow-md p-8 border border-green-300 sticky top-8 mb-8">
                <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸ“ Enrollment</h3>
                
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm text-gray-600">Capacity</span>
                        <span class="font-bold text-gray-800">{{ course.enrolled_students }}/{{ course.capacity }}</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3">
                        <div class="bg-blue-600 h-3 rounded-full" style="width: 65%;"></div>
                    </div>
                </div>

                <p class="text-sm text-gray-600 mb-6">
                    {% if course.enrolled_students >= course.capacity %}
                    <strong class="text-red-600">This course is full.</strong> Join the waitlist.
                    {% elif course.enrolled_students|add:"5" >= course.capacity %}
                    <strong class="text-orange-600">Only {{ course.capacity|add:"-"|add:course.enrolled_students }} spots left!</strong>
                    {% else %}
                    <strong class="text-green-600">{{ course.capacity|add:"-"|add:course.enrolled_students }} spots available</strong>
                    {% endif %}
                </p>

                {% if user.is_authenticated %}
                    {% if user_enrolled %}
                    <div class="mb-4 p-4 bg-green-50 border border-green-300 rounded-lg text-center">
                        <div class="text-2xl mb-2">âœ…</div>
                        <p class="text-sm text-green-800 font-semibold">You're Enrolled!</p>
                    </div>
                    <a href="{% url 'lms:dashboard' %}" class="w-full px-4 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition text-center block">
                        Go to Dashboard
                    </a>
                    {% elif course.enrolled_students < course.capacity %}
                    <form method="post" action="{% url 'ums:enroll' course.id %}">
                        {% csrf_token %}
                        <button type="submit" class="w-full px-4 py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition">
                            Enroll Now
                        </button>
                    </form>
                    {% else %}
                    <form method="post" action="{% url 'ums:waitlist' course.id %}">
                        {% csrf_token %}
                        <button type="submit" class="w-full px-4 py-3 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition">
                            Join Waitlist
                        </button>
                    </form>
                    {% endif %}
                {% else %}
                <a href="{% url 'accounts:login' %}" class="w-full px-4 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition text-center block mb-3">
                    Sign In to Enroll
                </a>
                <p class="text-xs text-gray-600 text-center">Don't have an account? <a href="{% url 'accounts:signup' %}" class="text-blue-600 hover:underline">Sign Up</a></p>
                {% endif %}
            </div>

            <!-- Quick Info -->
            <div class="bg-white rounded-lg shadow-md p-6 border border-gray-200 mb-8">
                <h3 class="text-lg font-bold text-gray-800 mb-4">â„¹ï¸ Quick Info</h3>
                
                <div class="space-y-4 text-sm">
                    <div>
                        <p class="text-gray-600 mb-1">Course Code</p>
                        <p class="font-semibold text-gray-800">{{ course.code }}</p>
                    </div>

                    <div class="border-t border-gray-200 pt-3">
                        <p class="text-gray-600 mb-1">Schedule</p>
                        <p class="font-semibold text-gray-800">Ongoing (Flexible)</p>
                    </div>

                    <div class="border-t border-gray-200 pt-3">
                        <p class="text-gray-600 mb-1">Language</p>
                        <p class="font-semibold text-gray-800">English</p>
                    </div>

                    <div class="border-t border-gray-200 pt-3">
                        <p class="text-gray-600 mb-1">Duration</p>
                        <p class="font-semibold text-gray-800">{{ course.duration_weeks }} weeks</p>
                    </div>
                </div>
            </div>

            <!-- Instructor Info -->
            <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-6 border border-blue-300">
                <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸ‘¨â€ğŸ« Instructor</h3>
                <div class="text-center">
                    <div class="text-5xl mb-2">ğŸ‘¨â€ğŸ“</div>
                    <p class="font-bold text-gray-800">{{ course.instructor_name }}</p>
                    <p class="text-sm text-gray-600 mb-4">{{ course.department.name }}</p>
                    <button class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-semibold hover:bg-blue-700 transition w-full">
                        Message Instructor
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}