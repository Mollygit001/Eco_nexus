{% extends 'base.html' %}
{% load static %}

{% block title %}{{ module.title }} - Eco-Nexus LMS{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- Breadcrumb -->
    <nav class="mb-6 text-sm text-gray-600">
        <a href="{% url 'lms:course_list' %}" class="text-blue-600 hover:underline">Courses</a>
        <span class="mx-2">/</span>
        <a href="{% url 'lms:course_detail' module.course.id %}" class="text-blue-600 hover:underline">{{ module.course.title }}</a>
        <span class="mx-2">/</span>
        <span>{{ module.title }}</span>
    </nav>

    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
        <!-- Main Content (3/4) -->
        <div class="lg:col-span-3">
            <!-- Module Header -->
            <div class="bg-gradient-to-r from-blue-50 to-green-50 rounded-lg p-8 mb-8 border border-blue-300">
                <div class="mb-4">
                    <span class="inline-block px-3 py-1 bg-blue-100 text-blue-800 text-xs font-bold rounded-full mb-3">
                        Module {{ module.order }}
                    </span>
                </div>
                <h1 class="text-4xl font-bold text-gray-800 mb-2">{{ module.title }}</h1>
                <p class="text-gray-600">{{ module.description }}</p>

                <!-- Module Stats -->
                <div class="grid grid-cols-3 gap-4 mt-6 pt-6 border-t border-blue-200">
                    <div>
                        <p class="text-sm text-gray-600">Lessons</p>
                        <p class="text-2xl font-bold text-blue-600">{{ lessons_count }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Quizzes</p>
                        <p class="text-2xl font-bold text-green-600">{{ quizzes_count }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Duration</p>
                        <p class="text-2xl font-bold text-orange-600">{{ module.duration_hours }}h</p>
                    </div>
                </div>
            </div>

            <!-- Progress Indicator -->
            <div class="bg-white rounded-lg shadow-md p-6 border border-gray-200 mb-8">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="text-lg font-bold text-gray-800">üìä Your Progress</h3>
                    <span class="text-lg font-bold text-blue-600">{{ progress }}%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-4">
                    <div class="bg-blue-600 h-4 rounded-full transition-all duration-300" style="width: 65%;"></div>
                </div>
                <p class="text-sm text-gray-600 mt-3">
                    {% if progress == 100 %}
                    <span class="text-green-600 font-semibold">‚úÖ Module Complete!</span>
                    {% elif progress > 50 %}
                    Great progress! Keep going!
                    {% elif progress > 0 %}
                    You've started this module. Continue learning!
                    {% else %}
                    Start learning to see your progress
                    {% endif %}
                </p>
            </div>

            <!-- Lessons Section -->
            <div class="bg-white rounded-lg shadow-md p-8 mb-8 border border-gray-200">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">üìö Lessons</h2>

                <div class="space-y-3">
                    {% for lesson in lessons %}
                    <a href="{% url 'lms:lesson_detail' module.course.id module.id lesson.id %}" class="block p-4 bg-gray-50 rounded-lg border border-gray-200 hover:border-blue-400 hover:bg-blue-50 transition group">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-2">
                                    <span class="text-2xl">üìñ</span>
                                    <h3 class="text-lg font-semibold text-gray-800 group-hover:text-blue-600">{{ lesson.title }}</h3>
                                    {% if lesson.is_completed %}
                                    <span class="inline-block bg-green-100 text-green-800 text-xs font-bold px-2 py-1 rounded">
                                        ‚úÖ Completed
                                    </span>
                                    {% endif %}
                                </div>
                                <p class="text-sm text-gray-600 mb-2">{{ lesson.description|truncatewords:20 }}</p>
                                <div class="flex items-center gap-4 text-xs text-gray-500">
                                    <span>‚è±Ô∏è {{ lesson.duration_minutes }} minutes</span>
                                    <span>üìù {{ lesson.content_type|title }}</span>
                                </div>
                            </div>
                            <div class="text-2xl group-hover:translate-x-1 transition">‚Üí</div>
                        </div>
                    </a>
                    {% empty %}
                    <p class="text-center py-6 text-gray-500">No lessons in this module yet.</p>
                    {% endfor %}
                </div>
            </div>

            <!-- Quizzes Section -->
            {% if quizzes %}
            <div class="bg-white rounded-lg shadow-md p-8 mb-8 border border-gray-200">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">üéØ Quizzes</h2>

                <div class="space-y-3">
                    {% for quiz in quizzes %}
                    <div class="p-4 bg-gray-50 rounded-lg border border-gray-200 hover:border-green-400 hover:bg-green-50 transition">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-2">
                                    <span class="text-2xl">üìù</span>
                                    <h3 class="text-lg font-semibold text-gray-800">{{ quiz.title }}</h3>
                                    {% if quiz.passed %}
                                    <span class="inline-block bg-green-100 text-green-800 text-xs font-bold px-2 py-1 rounded">
                                        ‚úÖ Passed
                                    </span>
                                    {% elif quiz.attempted %}
                                    <span class="inline-block bg-yellow-100 text-yellow-800 text-xs font-bold px-2 py-1 rounded">
                                        ‚è≥ Attempted
                                    </span>
                                    {% endif %}
                                </div>
                                <p class="text-sm text-gray-600 mb-2">{{ quiz.description }}</p>
                                <div class="flex items-center gap-4 text-xs text-gray-500">
                                    <span>üìã {{ quiz.question_count }} questions</span>
                                    <span>‚è±Ô∏è {{ quiz.time_limit }} minutes</span>
                                    <span>üéØ Pass: {{ quiz.passing_score }}%</span>
                                </div>
                                {% if quiz.attempted %}
                                <div class="mt-2 pt-2 border-t border-gray-200">
                                    <p class="text-xs text-gray-600">
                                        Your Score: <span class="font-bold text-green-600">{{ quiz.user_score }}%</span>
                                        ‚Ä¢ Attempts: <span class="font-bold">{{ quiz.attempt_count }}</span>
                                    </p>
                                </div>
                                {% endif %}
                            </div>
                            <a href="{% url 'lms:quiz' module.course.id module.id quiz.id %}" class="px-4 py-2 bg-green-600 text-white rounded-lg text-sm font-semibold hover:bg-green-700 transition whitespace-nowrap">
                                {% if quiz.attempted %}
                                Retake
                                {% else %}
                                Start Quiz
                                {% endif %}
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Resources Section -->
            <div class="bg-white rounded-lg shadow-md p-8 border border-gray-200">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">üìö Resources & Downloads</h2>

                <div class="space-y-3">
                    <div class="flex items-center gap-4 p-4 bg-blue-50 rounded-lg border border-blue-200 hover:bg-blue-100 transition cursor-pointer">
                        <span class="text-3xl">üìÑ</span>
                        <div class="flex-1">
                            <p class="font-semibold text-gray-800">Module Lecture Notes</p>
                            <p class="text-xs text-gray-600">PDF ‚Ä¢ 2.3 MB</p>
                        </div>
                        <button class="px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700 transition">
                            Download
                        </button>
                    </div>

                    <div class="flex items-center gap-4 p-4 bg-green-50 rounded-lg border border-green-200 hover:bg-green-100 transition cursor-pointer">
                        <span class="text-3xl">üé•</span>
                        <div class="flex-1">
                            <p class="font-semibold text-gray-800">Video Presentation</p>
                            <p class="text-xs text-gray-600">MP4 ‚Ä¢ 45 minutes</p>
                        </div>
                        <button class="px-3 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-700 transition">
                            Watch
                        </button>
                    </div>

                    <div class="flex items-center gap-4 p-4 bg-orange-50 rounded-lg border border-orange-200 hover:bg-orange-100 transition cursor-pointer">
                        <span class="text-3xl">üìä</span>
                        <div class="flex-1">
                            <p class="font-semibold text-gray-800">Study Guide</p>
                            <p class="text-xs text-gray-600">PDF ‚Ä¢ 1.8 MB</p>
                        </div>
                        <button class="px-3 py-1 bg-orange-600 text-white text-xs rounded hover:bg-orange-700 transition">
                            Download
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar (1/4) -->
        <div class="lg:col-span-1">
            <!-- Navigation Card -->
            <div class="bg-white rounded-lg shadow-md p-6 border border-gray-200 sticky top-8 mb-8">
                <h3 class="text-lg font-bold text-gray-800 mb-4">üß≠ Navigation</h3>
                
                <div class="space-y-2">
                    {% if previous_module %}
                    <a href="{% url 'lms:module_detail' module.course.id previous_module.id %}" class="block px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition text-sm">
                        ‚Üê Previous Module
                    </a>
                    {% endif %}

                    <a href="{% url 'lms:course_detail' module.course.id %}" class="block px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition text-sm text-center font-semibold">
                        Back to Course
                    </a>

                    {% if next_module %}
                    <a href="{% url 'lms:module_detail' module.course.id next_module.id %}" class="block px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition text-sm text-center font-semibold">
                        Next Module ‚Üí
                    </a>
                    {% endif %}
                </div>
            </div>

            <!-- Module Info -->
            <div class="bg-white rounded-lg shadow-md p-6 border border-gray-200 mb-8">
                <h3 class="text-lg font-bold text-gray-800 mb-4">‚ÑπÔ∏è Module Info</h3>

                <div class="space-y-3 text-sm">
                    <div>
                        <p class="text-gray-600 mb-1">Duration</p>
                        <p class="font-semibold text-gray-800">{{ module.duration_hours }} hours</p>
                    </div>

                    <div class="border-t border-gray-200 pt-3">
                        <p class="text-gray-600 mb-1">Difficulty</p>
                        <p class="font-semibold text-gray-800 capitalize">{{ module.difficulty_level }}</p>
                    </div>

                    <div class="border-t border-gray-200 pt-3">
                        <p class="text-gray-600 mb-1">Lessons</p>
                        <p class="font-semibold text-gray-800">{{ lessons_count }} total</p>
                    </div>

                    <div class="border-t border-gray-200 pt-3">
                        <p class="text-gray-600 mb-1">Status</p>
                        <p class="font-semibold">
                            {% if progress == 100 %}
                            <span class="text-green-600">‚úÖ Complete</span>
                            {% elif progress > 0 %}
                            <span class="text-yellow-600">üü° In Progress</span>
                            {% else %}
                            <span class="text-gray-600">‚ö™ Not Started</span>
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>

            <!-- Learning Goals -->
            <div class="bg-blue-50 rounded-lg p-6 border border-blue-300">
                <h3 class="text-lg font-bold text-gray-800 mb-4">üéØ Learning Goals</h3>
                <ul class="space-y-2 text-sm text-gray-700">
                    <li class="flex gap-2">
                        <span>‚úì</span>
                        <span>Understand core concepts</span>
                    </li>
                    <li class="flex gap-2">
                        <span>‚úì</span>
                        <span>Apply knowledge to scenarios</span>
                    </li>
                    <li class="flex gap-2">
                        <span>‚úì</span>
                        <span>Pass quiz with 70%+</span>
                    </li>
                    <li class="flex gap-2">
                        <span>‚úì</span>
                        <span>Complete all lessons</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}